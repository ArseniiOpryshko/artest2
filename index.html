<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no,"
    />
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <title>AR.js –õ–µ—Ç–∞—é—â–∞—è –ú–æ–¥–µ–ª—å</title>
  </head>
  <body style="margin: 0px; overflow: hidden">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-animation-mixer/master/dist/aframe-animation-mixer.min.js"></script>
    <script>
      AFRAME.registerComponent("animate-mouth", {
        init: function () {
          let el = this.el;
          el.addEventListener("click", function () {
            el.setAttribute("animation", {
              property: "position",
              to: "0 0.1 0",
              dur: 500,
              dir: "alternate",
              loop: true,
              easing: "easeInOutQuad",
            });
          });
        },
      });
    </script>

    <a-scene embedded arjs>
      <a-marker preset="hiro" id="marker">
        <!-- Full Model -->
        <a-entity
          id="model"
          gltf-model="Frozy_Frost.glb"
          position="0 0 0"
          rotation="270 0 0"
          scale="0.01 0.01 0.01"
        >
        </a-entity>

        <!-- Animate Teeth -->
        <a-entity
          gltf-model="Frozy_Frost.glb#Teeth_low"
          position="0 0.2 0"
          scale="0.01 0.01 0.01"
          animation="property: position; to: 0 0.3 0; dur: 1000; loop: true; direction: alternate"
        ></a-entity>

        <!-- Animate Tongue -->
        <a-entity
          gltf-model="Frozy_Frost.glb#Tongue_low"
          position="0 0 0"
          scale="0.01 0.01 0.01"
          animation="property: rotation; to: 0 30 0; dur: 800; loop: true; direction: alternate"
        ></a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let marker = document.querySelector("#marker");
        let model = document.querySelector("#model");

        const speakBtn = document.getElementById("speakBtn");

        marker.addEventListener("markerFound", () => {
          console.log("–ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω!");

          // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–ª–µ—Ç–∞ –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑
          model.setAttribute(
            "animation",
            "property: position; from: 0 0 0; to: 0 0.3 0; dir: alternate; dur: 1000; loop: true; easing: easeInOutSine"
          );
        });

        marker.addEventListener("markerLost", () => {
          console.log("–ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω!");

          // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
          model.removeAttribute("animation");
          model.setAttribute("position", "0 0 0");
        });

        const synth = window.speechSynthesis;
        const utterance = new SpeechSynthesisUtterance(
          "Hi I am from Japan. Can I follow you friend"
        );

        // üì¢ –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ TTS
        function speakText() {
          if (synth.speaking) return;

          // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≥—É–±
          utterance.onstart = () => startLipAnimation();
          utterance.onend = () => stopLipAnimation();

          // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–∑–≤—É—á–∫—É
          synth.speak(utterance);
        }

        // üó£Ô∏è –ê–Ω–∏–º–∞—Ü–∏—è –≥—É–±
        function startLipAnimation() {
          // –ê–Ω–∏–º–∏—Ä—É–µ–º –∑—É–±—ã –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑
          document
            .querySelector("#teeth")
            .setAttribute(
              "animation",
              "property: position; from: 0 0 0; to: 0 -0.02 0; dir: alternate; dur: 100; loop: true;"
            );
          // –ê–Ω–∏–º–∏—Ä—É–µ–º —è–∑—ã–∫ –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑
          document
            .querySelector("#tongue")
            .setAttribute(
              "animation",
              "property: position; from: 0 0 0; to: 0 0.01 0; dir: alternate; dur: 100; loop: true;"
            );
        }

        function stopLipAnimation() {
          document.querySelector("#teeth").removeAttribute("animation");
          document.querySelector("#tongue").removeAttribute("animation");
        }
        // üìå –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ä–µ—á—å
        speakBtn.addEventListener("click", speakText);
      });
    </script>
  </body>
</html>
